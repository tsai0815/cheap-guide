<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <title>Google Map with Address Search and Info</title>
    <style>
      /* 設定地圖與輸入框的樣式 */
      #map {
        height: 70vh;
        width: 100%;
      }
      #input-container {
        margin: 10px;
      }
      input[type="text"] {
        width: 200px;
        padding: 10px;
        margin-right: 10px;
      }
      button {
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h3>輸入地址與資訊來標記地點</h3>
    <div id="input-container">
      <input id="address" type="text" placeholder="請輸入地址">
      <input id="name" type="text" placeholder="名稱">
      <input id="quantity" type="text" placeholder="數量">
      <input id="description" type="text" placeholder="描述">
      <button onclick="geocodeAddress()">標記地址</button>
    </div>
    <div id="map"></div>

    <script>
      let map;
      let geocoder;
      let marker;
      let infowindow;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 25.0330, lng: 121.5654 }, // 台北市的初始位置
          zoom: 13,
        });
        geocoder = new google.maps.Geocoder();
        infowindow = new google.maps.InfoWindow(); // 用來顯示資訊
      }

      // 地址轉換成地點並標記
      function geocodeAddress() {
        const address = document.getElementById("address").value;
        const name = document.getElementById("name").value;
        const quantity = document.getElementById("quantity").value;
        const description = document.getElementById("description").value;

        geocoder.geocode({ address: address }, (results, status) => {
          if (status === "OK") {
            // 清除之前的標記
            if (marker) {
              marker.setMap(null);
            }

            // 設定新的標記
            const location = results[0].geometry.location;
            marker = new google.maps.Marker({
              map: map,
              position: location,
              icon: {
                url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png", // 紅色標記
              },
            });

            // 設定點擊事件，顯示資訊視窗
            marker.addListener("click", () => {
              const contentString = `
                <div>
                  <h4>${name}</h4>
                  <p><strong>數量：</strong> ${quantity}</p>
                  <p><strong>描述：</strong> ${description}</p>
                </div>
              `;
              infowindow.setContent(contentString);
              infowindow.open(map, marker);
            });

            // 將地圖中心設為新標記的位置
            map.setCenter(location);
          } else {
            alert("Geocode was not successful for the following reason: " + status);
          }
        });
      }
    </script>

    <!-- 引入 Google Maps API -->
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCR-Xf5Pd5MC9bJejrgROSGacSUNBoVXDw
      &callback=initMap"
    ></script>
  </body>
</html>
